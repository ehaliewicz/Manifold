#include <genesis.h>
#include "cart_ram.h"
#include "colors.h"
#include "config.h"
#include "div_lut.h"
#include "math3d.h"
#include "utils.h"
#include "texture.h"
#include "textures.h"
#include "tex_tables_lookup.h"


// 64 pixels tall
// 64 pixels wide
// which means 64 rasterized columns

void calc_textures_for_light_level(s8 light_level, lit_texture* lit_tex, u16** dark_tex, u16** mid_tex, u16** light_tex) {
    *dark_tex = lit_tex->dark;
    *mid_tex = lit_tex->mid;
    *light_tex = lit_tex->light;
    /*
    u16* dtex = lit_tex->dark;
    u16* mtex = lit_tex->mid;
    u16* ltex = lit_tex->light;

    switch(light_level) {
      case -2:
        *light_tex = dtex;
        *mid_tex = dtex;
        *dark_tex = dtex;
        break;
      case -1:
        *light_tex = lit_tex->mid;
        *mid_tex = lit_tex->dark;
        *dark_tex = lit_tex->dark;
        break;
      case 0:
        *light_tex = ltex;
        *mid_tex = mtex;
        *dark_tex = lit_tex->dark;
        break;
      case 1:
        *dark_tex = mtex;
        *mid_tex = ltex;
        *light_tex = ltex;
        break;
      case 2:
        *dark_tex = ltex;
        *mid_tex = ltex;
        *light_tex = ltex;
        break;
    }
    */
}


persp_params calc_perspective(u16 z1_12_4, u16 z2_12_4, u32 left_u_16, u32 right_u_16, s16 dx) {
    persp_params ret;
    u32 one_over_z_26 = z_12_4_to_one_over_z_26[z1_12_4>>4];
    u32 one_over_z_end_26 = z_12_4_to_one_over_z_26[z2_12_4>>4];


    s32 d_one_over_z_26 = (one_over_z_end_26 - one_over_z_26);

    u32 u_over_z_23 = (left_u_16<<(TRANS_Z_FRAC_BITS+7))/z1_12_4;  
    u32 u_over_z_end_23 = (right_u_16<<(TRANS_Z_FRAC_BITS+7))/z2_12_4;


    s32 d_u_over_z_23 = (u_over_z_end_23 - u_over_z_23);


    ret.one_over_z_26 = one_over_z_26;

    ret.d_one_over_z_dx_26 = (d_one_over_z_26/dx);
    ret.u_over_z_23 = u_over_z_23;
    ret.d_u_over_z_dx_23 = d_u_over_z_23/dx;
    return ret;
}


u32 unclipped_dy_recip_table[512] = {
  (TEX_HEIGHT<<16)/1,
(TEX_HEIGHT<<16)/2,(TEX_HEIGHT<<16)/3,(TEX_HEIGHT<<16)/4,(TEX_HEIGHT<<16)/5,(TEX_HEIGHT<<16)/6,
(TEX_HEIGHT<<16)/7,(TEX_HEIGHT<<16)/8,(TEX_HEIGHT<<16)/9,(TEX_HEIGHT<<16)/10,(TEX_HEIGHT<<16)/11,
(TEX_HEIGHT<<16)/12,(TEX_HEIGHT<<16)/13,(TEX_HEIGHT<<16)/14,(TEX_HEIGHT<<16)/15,(TEX_HEIGHT<<16)/16,
(TEX_HEIGHT<<16)/17,(TEX_HEIGHT<<16)/18,(TEX_HEIGHT<<16)/19,(TEX_HEIGHT<<16)/20,(TEX_HEIGHT<<16)/21,
(TEX_HEIGHT<<16)/22,(TEX_HEIGHT<<16)/23,(TEX_HEIGHT<<16)/24,(TEX_HEIGHT<<16)/25,(TEX_HEIGHT<<16)/26,
(TEX_HEIGHT<<16)/27,(TEX_HEIGHT<<16)/28,(TEX_HEIGHT<<16)/29,(TEX_HEIGHT<<16)/30,(TEX_HEIGHT<<16)/31,
(TEX_HEIGHT<<16)/32,(TEX_HEIGHT<<16)/33,(TEX_HEIGHT<<16)/34,(TEX_HEIGHT<<16)/35,(TEX_HEIGHT<<16)/36,
(TEX_HEIGHT<<16)/37,(TEX_HEIGHT<<16)/38,(TEX_HEIGHT<<16)/39,(TEX_HEIGHT<<16)/40,(TEX_HEIGHT<<16)/41,
(TEX_HEIGHT<<16)/42,(TEX_HEIGHT<<16)/43,(TEX_HEIGHT<<16)/44,(TEX_HEIGHT<<16)/45,(TEX_HEIGHT<<16)/46,
(TEX_HEIGHT<<16)/47,(TEX_HEIGHT<<16)/48,(TEX_HEIGHT<<16)/49,(TEX_HEIGHT<<16)/50,(TEX_HEIGHT<<16)/51,
(TEX_HEIGHT<<16)/52,(TEX_HEIGHT<<16)/53,(TEX_HEIGHT<<16)/54,(TEX_HEIGHT<<16)/55,(TEX_HEIGHT<<16)/56,
(TEX_HEIGHT<<16)/57,(TEX_HEIGHT<<16)/58,(TEX_HEIGHT<<16)/59,(TEX_HEIGHT<<16)/60,(TEX_HEIGHT<<16)/61,
(TEX_HEIGHT<<16)/62,(TEX_HEIGHT<<16)/63,(TEX_HEIGHT<<16)/64,(TEX_HEIGHT<<16)/65,(TEX_HEIGHT<<16)/66,
(TEX_HEIGHT<<16)/67,(TEX_HEIGHT<<16)/68,(TEX_HEIGHT<<16)/69,(TEX_HEIGHT<<16)/70,(TEX_HEIGHT<<16)/71,
(TEX_HEIGHT<<16)/72,(TEX_HEIGHT<<16)/73,(TEX_HEIGHT<<16)/74,(TEX_HEIGHT<<16)/75,(TEX_HEIGHT<<16)/76,
(TEX_HEIGHT<<16)/77,(TEX_HEIGHT<<16)/78,(TEX_HEIGHT<<16)/79,(TEX_HEIGHT<<16)/80,(TEX_HEIGHT<<16)/81,
(TEX_HEIGHT<<16)/82,(TEX_HEIGHT<<16)/83,(TEX_HEIGHT<<16)/84,(TEX_HEIGHT<<16)/85,(TEX_HEIGHT<<16)/86,
(TEX_HEIGHT<<16)/87,(TEX_HEIGHT<<16)/88,(TEX_HEIGHT<<16)/89,(TEX_HEIGHT<<16)/90,(TEX_HEIGHT<<16)/91,
(TEX_HEIGHT<<16)/92,(TEX_HEIGHT<<16)/93,(TEX_HEIGHT<<16)/94,(TEX_HEIGHT<<16)/95,(TEX_HEIGHT<<16)/96,
(TEX_HEIGHT<<16)/97,(TEX_HEIGHT<<16)/98,(TEX_HEIGHT<<16)/99,(TEX_HEIGHT<<16)/100,(TEX_HEIGHT<<16)/101,
(TEX_HEIGHT<<16)/102,(TEX_HEIGHT<<16)/103,(TEX_HEIGHT<<16)/104,(TEX_HEIGHT<<16)/105,(TEX_HEIGHT<<16)/106,
(TEX_HEIGHT<<16)/107,(TEX_HEIGHT<<16)/108,(TEX_HEIGHT<<16)/109,(TEX_HEIGHT<<16)/110,(TEX_HEIGHT<<16)/111,
(TEX_HEIGHT<<16)/112,(TEX_HEIGHT<<16)/113,(TEX_HEIGHT<<16)/114,(TEX_HEIGHT<<16)/115,(TEX_HEIGHT<<16)/116,
(TEX_HEIGHT<<16)/117,(TEX_HEIGHT<<16)/118,(TEX_HEIGHT<<16)/119,(TEX_HEIGHT<<16)/120,(TEX_HEIGHT<<16)/121,
(TEX_HEIGHT<<16)/122,(TEX_HEIGHT<<16)/123,(TEX_HEIGHT<<16)/124,(TEX_HEIGHT<<16)/125,(TEX_HEIGHT<<16)/126,
(TEX_HEIGHT<<16)/127,(TEX_HEIGHT<<16)/128,(TEX_HEIGHT<<16)/129,(TEX_HEIGHT<<16)/130,(TEX_HEIGHT<<16)/131,
(TEX_HEIGHT<<16)/132,(TEX_HEIGHT<<16)/133,(TEX_HEIGHT<<16)/134,(TEX_HEIGHT<<16)/135,(TEX_HEIGHT<<16)/136,
(TEX_HEIGHT<<16)/137,(TEX_HEIGHT<<16)/138,(TEX_HEIGHT<<16)/139,(TEX_HEIGHT<<16)/140,(TEX_HEIGHT<<16)/141,
(TEX_HEIGHT<<16)/142,(TEX_HEIGHT<<16)/143,(TEX_HEIGHT<<16)/144,(TEX_HEIGHT<<16)/145,(TEX_HEIGHT<<16)/146,
(TEX_HEIGHT<<16)/147,(TEX_HEIGHT<<16)/148,(TEX_HEIGHT<<16)/149,(TEX_HEIGHT<<16)/150,(TEX_HEIGHT<<16)/151,
(TEX_HEIGHT<<16)/152,(TEX_HEIGHT<<16)/153,(TEX_HEIGHT<<16)/154,(TEX_HEIGHT<<16)/155,(TEX_HEIGHT<<16)/156,
(TEX_HEIGHT<<16)/157,(TEX_HEIGHT<<16)/158,(TEX_HEIGHT<<16)/159,(TEX_HEIGHT<<16)/160,(TEX_HEIGHT<<16)/161,
(TEX_HEIGHT<<16)/162,(TEX_HEIGHT<<16)/163,(TEX_HEIGHT<<16)/164,(TEX_HEIGHT<<16)/165,(TEX_HEIGHT<<16)/166,
(TEX_HEIGHT<<16)/167,(TEX_HEIGHT<<16)/168,(TEX_HEIGHT<<16)/169,(TEX_HEIGHT<<16)/170,(TEX_HEIGHT<<16)/171,
(TEX_HEIGHT<<16)/172,(TEX_HEIGHT<<16)/173,(TEX_HEIGHT<<16)/174,(TEX_HEIGHT<<16)/175,(TEX_HEIGHT<<16)/176,
(TEX_HEIGHT<<16)/177,(TEX_HEIGHT<<16)/178,(TEX_HEIGHT<<16)/179,(TEX_HEIGHT<<16)/180,(TEX_HEIGHT<<16)/181,
(TEX_HEIGHT<<16)/182,(TEX_HEIGHT<<16)/183,(TEX_HEIGHT<<16)/184,(TEX_HEIGHT<<16)/185,(TEX_HEIGHT<<16)/186,
(TEX_HEIGHT<<16)/187,(TEX_HEIGHT<<16)/188,(TEX_HEIGHT<<16)/189,(TEX_HEIGHT<<16)/190,(TEX_HEIGHT<<16)/191,
(TEX_HEIGHT<<16)/192,(TEX_HEIGHT<<16)/193,(TEX_HEIGHT<<16)/194,(TEX_HEIGHT<<16)/195,(TEX_HEIGHT<<16)/196,
(TEX_HEIGHT<<16)/197,(TEX_HEIGHT<<16)/198,(TEX_HEIGHT<<16)/199,(TEX_HEIGHT<<16)/200,(TEX_HEIGHT<<16)/201,
(TEX_HEIGHT<<16)/202,(TEX_HEIGHT<<16)/203,(TEX_HEIGHT<<16)/204,(TEX_HEIGHT<<16)/205,(TEX_HEIGHT<<16)/206,
(TEX_HEIGHT<<16)/207,(TEX_HEIGHT<<16)/208,(TEX_HEIGHT<<16)/209,(TEX_HEIGHT<<16)/210,(TEX_HEIGHT<<16)/211,
(TEX_HEIGHT<<16)/212,(TEX_HEIGHT<<16)/213,(TEX_HEIGHT<<16)/214,(TEX_HEIGHT<<16)/215,(TEX_HEIGHT<<16)/216,
(TEX_HEIGHT<<16)/217,(TEX_HEIGHT<<16)/218,(TEX_HEIGHT<<16)/219,(TEX_HEIGHT<<16)/220,(TEX_HEIGHT<<16)/221,
(TEX_HEIGHT<<16)/222,(TEX_HEIGHT<<16)/223,(TEX_HEIGHT<<16)/224,(TEX_HEIGHT<<16)/225,(TEX_HEIGHT<<16)/226,
(TEX_HEIGHT<<16)/227,(TEX_HEIGHT<<16)/228,(TEX_HEIGHT<<16)/229,(TEX_HEIGHT<<16)/230,(TEX_HEIGHT<<16)/231,
(TEX_HEIGHT<<16)/232,(TEX_HEIGHT<<16)/233,(TEX_HEIGHT<<16)/234,(TEX_HEIGHT<<16)/235,(TEX_HEIGHT<<16)/236,
(TEX_HEIGHT<<16)/237,(TEX_HEIGHT<<16)/238,(TEX_HEIGHT<<16)/239,(TEX_HEIGHT<<16)/240,(TEX_HEIGHT<<16)/241,
(TEX_HEIGHT<<16)/242,(TEX_HEIGHT<<16)/243,(TEX_HEIGHT<<16)/244,(TEX_HEIGHT<<16)/245,(TEX_HEIGHT<<16)/246,
(TEX_HEIGHT<<16)/247,(TEX_HEIGHT<<16)/248,(TEX_HEIGHT<<16)/249,(TEX_HEIGHT<<16)/250,(TEX_HEIGHT<<16)/251,
(TEX_HEIGHT<<16)/252,(TEX_HEIGHT<<16)/253,(TEX_HEIGHT<<16)/254,(TEX_HEIGHT<<16)/255,(TEX_HEIGHT<<16)/256,
(TEX_HEIGHT<<16)/257,(TEX_HEIGHT<<16)/258,(TEX_HEIGHT<<16)/259,(TEX_HEIGHT<<16)/260,(TEX_HEIGHT<<16)/261,
(TEX_HEIGHT<<16)/262,(TEX_HEIGHT<<16)/263,(TEX_HEIGHT<<16)/264,(TEX_HEIGHT<<16)/265,(TEX_HEIGHT<<16)/266,
(TEX_HEIGHT<<16)/267,(TEX_HEIGHT<<16)/268,(TEX_HEIGHT<<16)/269,(TEX_HEIGHT<<16)/270,(TEX_HEIGHT<<16)/271,
(TEX_HEIGHT<<16)/272,(TEX_HEIGHT<<16)/273,(TEX_HEIGHT<<16)/274,(TEX_HEIGHT<<16)/275,(TEX_HEIGHT<<16)/276,
(TEX_HEIGHT<<16)/277,(TEX_HEIGHT<<16)/278,(TEX_HEIGHT<<16)/279,(TEX_HEIGHT<<16)/280,(TEX_HEIGHT<<16)/281,
(TEX_HEIGHT<<16)/282,(TEX_HEIGHT<<16)/283,(TEX_HEIGHT<<16)/284,(TEX_HEIGHT<<16)/285,(TEX_HEIGHT<<16)/286,
(TEX_HEIGHT<<16)/287,(TEX_HEIGHT<<16)/288,(TEX_HEIGHT<<16)/289,(TEX_HEIGHT<<16)/290,(TEX_HEIGHT<<16)/291,
(TEX_HEIGHT<<16)/292,(TEX_HEIGHT<<16)/293,(TEX_HEIGHT<<16)/294,(TEX_HEIGHT<<16)/295,(TEX_HEIGHT<<16)/296,
(TEX_HEIGHT<<16)/297,(TEX_HEIGHT<<16)/298,(TEX_HEIGHT<<16)/299,(TEX_HEIGHT<<16)/300,(TEX_HEIGHT<<16)/301,
(TEX_HEIGHT<<16)/302,(TEX_HEIGHT<<16)/303,(TEX_HEIGHT<<16)/304,(TEX_HEIGHT<<16)/305,(TEX_HEIGHT<<16)/306,
(TEX_HEIGHT<<16)/307,(TEX_HEIGHT<<16)/308,(TEX_HEIGHT<<16)/309,(TEX_HEIGHT<<16)/310,(TEX_HEIGHT<<16)/311,
(TEX_HEIGHT<<16)/312,(TEX_HEIGHT<<16)/313,(TEX_HEIGHT<<16)/314,(TEX_HEIGHT<<16)/315,(TEX_HEIGHT<<16)/316,
(TEX_HEIGHT<<16)/317,(TEX_HEIGHT<<16)/318,(TEX_HEIGHT<<16)/319,(TEX_HEIGHT<<16)/320,(TEX_HEIGHT<<16)/321,
(TEX_HEIGHT<<16)/322,(TEX_HEIGHT<<16)/323,(TEX_HEIGHT<<16)/324,(TEX_HEIGHT<<16)/325,(TEX_HEIGHT<<16)/326,
(TEX_HEIGHT<<16)/327,(TEX_HEIGHT<<16)/328,(TEX_HEIGHT<<16)/329,(TEX_HEIGHT<<16)/330,(TEX_HEIGHT<<16)/331,
(TEX_HEIGHT<<16)/332,(TEX_HEIGHT<<16)/333,(TEX_HEIGHT<<16)/334,(TEX_HEIGHT<<16)/335,(TEX_HEIGHT<<16)/336,
(TEX_HEIGHT<<16)/337,(TEX_HEIGHT<<16)/338,(TEX_HEIGHT<<16)/339,(TEX_HEIGHT<<16)/340,(TEX_HEIGHT<<16)/341,
(TEX_HEIGHT<<16)/342,(TEX_HEIGHT<<16)/343,(TEX_HEIGHT<<16)/344,(TEX_HEIGHT<<16)/345,(TEX_HEIGHT<<16)/346,
(TEX_HEIGHT<<16)/347,(TEX_HEIGHT<<16)/348,(TEX_HEIGHT<<16)/349,(TEX_HEIGHT<<16)/350,(TEX_HEIGHT<<16)/351,
(TEX_HEIGHT<<16)/352,(TEX_HEIGHT<<16)/353,(TEX_HEIGHT<<16)/354,(TEX_HEIGHT<<16)/355,(TEX_HEIGHT<<16)/356,
(TEX_HEIGHT<<16)/357,(TEX_HEIGHT<<16)/358,(TEX_HEIGHT<<16)/359,(TEX_HEIGHT<<16)/360,(TEX_HEIGHT<<16)/361,
(TEX_HEIGHT<<16)/362,(TEX_HEIGHT<<16)/363,(TEX_HEIGHT<<16)/364,(TEX_HEIGHT<<16)/365,(TEX_HEIGHT<<16)/366,
(TEX_HEIGHT<<16)/367,(TEX_HEIGHT<<16)/368,(TEX_HEIGHT<<16)/369,(TEX_HEIGHT<<16)/370,(TEX_HEIGHT<<16)/371,
(TEX_HEIGHT<<16)/372,(TEX_HEIGHT<<16)/373,(TEX_HEIGHT<<16)/374,(TEX_HEIGHT<<16)/375,(TEX_HEIGHT<<16)/376,
(TEX_HEIGHT<<16)/377,(TEX_HEIGHT<<16)/378,(TEX_HEIGHT<<16)/379,(TEX_HEIGHT<<16)/380,(TEX_HEIGHT<<16)/381,
(TEX_HEIGHT<<16)/382,(TEX_HEIGHT<<16)/383,(TEX_HEIGHT<<16)/384,(TEX_HEIGHT<<16)/385,(TEX_HEIGHT<<16)/386,
(TEX_HEIGHT<<16)/387,(TEX_HEIGHT<<16)/388,(TEX_HEIGHT<<16)/389,(TEX_HEIGHT<<16)/390,(TEX_HEIGHT<<16)/391,
(TEX_HEIGHT<<16)/392,(TEX_HEIGHT<<16)/393,(TEX_HEIGHT<<16)/394,(TEX_HEIGHT<<16)/395,(TEX_HEIGHT<<16)/396,
(TEX_HEIGHT<<16)/397,(TEX_HEIGHT<<16)/398,(TEX_HEIGHT<<16)/399,(TEX_HEIGHT<<16)/400,(TEX_HEIGHT<<16)/401,
(TEX_HEIGHT<<16)/402,(TEX_HEIGHT<<16)/403,(TEX_HEIGHT<<16)/404,(TEX_HEIGHT<<16)/405,(TEX_HEIGHT<<16)/406,
(TEX_HEIGHT<<16)/407,(TEX_HEIGHT<<16)/408,(TEX_HEIGHT<<16)/409,(TEX_HEIGHT<<16)/410,(TEX_HEIGHT<<16)/411,
(TEX_HEIGHT<<16)/412,(TEX_HEIGHT<<16)/413,(TEX_HEIGHT<<16)/414,(TEX_HEIGHT<<16)/415,(TEX_HEIGHT<<16)/416,
(TEX_HEIGHT<<16)/417,(TEX_HEIGHT<<16)/418,(TEX_HEIGHT<<16)/419,(TEX_HEIGHT<<16)/420,(TEX_HEIGHT<<16)/421,
(TEX_HEIGHT<<16)/422,(TEX_HEIGHT<<16)/423,(TEX_HEIGHT<<16)/424,(TEX_HEIGHT<<16)/425,(TEX_HEIGHT<<16)/426,
(TEX_HEIGHT<<16)/427,(TEX_HEIGHT<<16)/428,(TEX_HEIGHT<<16)/429,(TEX_HEIGHT<<16)/430,(TEX_HEIGHT<<16)/431,
(TEX_HEIGHT<<16)/432,(TEX_HEIGHT<<16)/433,(TEX_HEIGHT<<16)/434,(TEX_HEIGHT<<16)/435,(TEX_HEIGHT<<16)/436,
(TEX_HEIGHT<<16)/437,(TEX_HEIGHT<<16)/438,(TEX_HEIGHT<<16)/439,(TEX_HEIGHT<<16)/440,(TEX_HEIGHT<<16)/441,
(TEX_HEIGHT<<16)/442,(TEX_HEIGHT<<16)/443,(TEX_HEIGHT<<16)/444,(TEX_HEIGHT<<16)/445,(TEX_HEIGHT<<16)/446,
(TEX_HEIGHT<<16)/447,(TEX_HEIGHT<<16)/448,(TEX_HEIGHT<<16)/449,(TEX_HEIGHT<<16)/450,(TEX_HEIGHT<<16)/451,
(TEX_HEIGHT<<16)/452,(TEX_HEIGHT<<16)/453,(TEX_HEIGHT<<16)/454,(TEX_HEIGHT<<16)/455,(TEX_HEIGHT<<16)/456,
(TEX_HEIGHT<<16)/457,(TEX_HEIGHT<<16)/458,(TEX_HEIGHT<<16)/459,(TEX_HEIGHT<<16)/460,(TEX_HEIGHT<<16)/461,
(TEX_HEIGHT<<16)/462,(TEX_HEIGHT<<16)/463,(TEX_HEIGHT<<16)/464,(TEX_HEIGHT<<16)/465,(TEX_HEIGHT<<16)/466,
(TEX_HEIGHT<<16)/467,(TEX_HEIGHT<<16)/468,(TEX_HEIGHT<<16)/469,(TEX_HEIGHT<<16)/470,(TEX_HEIGHT<<16)/471,
(TEX_HEIGHT<<16)/472,(TEX_HEIGHT<<16)/473,(TEX_HEIGHT<<16)/474,(TEX_HEIGHT<<16)/475,(TEX_HEIGHT<<16)/476,
(TEX_HEIGHT<<16)/477,(TEX_HEIGHT<<16)/478,(TEX_HEIGHT<<16)/479,(TEX_HEIGHT<<16)/480,(TEX_HEIGHT<<16)/481,
(TEX_HEIGHT<<16)/482,(TEX_HEIGHT<<16)/483,(TEX_HEIGHT<<16)/484,(TEX_HEIGHT<<16)/485,(TEX_HEIGHT<<16)/486,
(TEX_HEIGHT<<16)/487,(TEX_HEIGHT<<16)/488,(TEX_HEIGHT<<16)/489,(TEX_HEIGHT<<16)/490,(TEX_HEIGHT<<16)/491,
(TEX_HEIGHT<<16)/492,(TEX_HEIGHT<<16)/493,(TEX_HEIGHT<<16)/494,(TEX_HEIGHT<<16)/495,(TEX_HEIGHT<<16)/496,
(TEX_HEIGHT<<16)/497,(TEX_HEIGHT<<16)/498,(TEX_HEIGHT<<16)/499,(TEX_HEIGHT<<16)/500,(TEX_HEIGHT<<16)/501,
(TEX_HEIGHT<<16)/502,(TEX_HEIGHT<<16)/503,(TEX_HEIGHT<<16)/504,(TEX_HEIGHT<<16)/505,(TEX_HEIGHT<<16)/506,
(TEX_HEIGHT<<16)/507,(TEX_HEIGHT<<16)/508,(TEX_HEIGHT<<16)/509,(TEX_HEIGHT<<16)/510,(TEX_HEIGHT<<16)/511,
(TEX_HEIGHT<<16)/512,
};

void draw_texture_vertical_line(s16 unclipped_y0, s16 y0, s16 unclipped_y1, s16 y1, u8* col_ptr, u16* tex_column) {
    //return ;

    s16 unclipped_dy = unclipped_y1 - unclipped_y0;
    if(unclipped_dy > 512) { return; }

    col_ptr = col_ptr + (y0<<1);
    //u32* tex_column = &(texture[tex_column*TEX_HEIGHT]);
    u16* word_col_ptr = (u16*)col_ptr;

    s32 dy = y1-y0;


    // using ROM jump tables
    void* base_call_loc = jump_table_lut[unclipped_dy];

    int clip_top = y0-unclipped_y0;
    int clip_bot = unclipped_y1-y1;


    if(clip_bot != 0) {
        u32 du_dy = unclipped_dy_recip_table[unclipped_dy-1];
        u32 clip_bot_du_fix = du_dy * clip_bot;
        
        u16 clip_bot_du = clip_bot_du_fix>>16;
        tex_column -= (clip_bot_du);
    }   
    
    register const a0 asm ("%a0") = ((u32)tex_column); // - (clip_bot<<1 * du_dy);
    register const  a1 asm ("%a1") = (u32)col_ptr;

    register const  a2 asm ("%a2") = base_call_loc + (clip_top<<2) + (clip_bot << 2);

    
    __asm volatile(
        "jsr (%0)"
        :
        : "a" (a2), "a" (a0), "a" (a1)
    );


    return; 
    
}
    


// column 0            column 1            column 2                column 3
// blue blue blue blue blue blue blue blue green green green green green green green green